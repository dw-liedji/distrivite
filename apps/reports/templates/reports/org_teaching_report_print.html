{% extends 'core/pdf_base.html' %}
{% load static %}
{% load humanize %}
{% load qr_code %}
{% load core %}


{% block title %}
Organizations facturation report
{% endblock title %}

{% block content %}
<div class="has-text-left">
    <div class="is-flex is-justify-content-center is-align-items-center">
        <figure class="image box p-0 my-0 ml-0 mr-3">
            {% if request.organization.logo %}
            <img class="image" src="{{ request.organization.logo.url }}" width="110" height="110">
            {% else %}
            <img class="image" src="{% static 'core/img/quanta_logo.jpg' %}" width="110" height="110">
            {% endif %}
        </figure>
        <div class="box has-text-centered p-0 m-0">
            <p class="title is-size-1 mb-1 pb-0">{{ request.organization.name }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">{{ request.organization.street_address }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">BP 8735-YANSOKI-DOUALA,
                tel:{{ request.organization.contact_number }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">Email:{{ request.organization.contact_email }}</p>
        </div>
    </div>
</div>
<hr />
<p class="title is-size-2 has-text-centered">Rapport de toutes les ventes</p>
<p class="subtitle is-size-5 has-text-centered">Imprimé le {% now "SHORT_DATETIME_FORMAT" %}</p>

<div class="is-flex is-align-items-center is-justify-content-start">
    {% for field in facturation_filter.form %}
    <span class="mx-2 has-text-centered">
        {% if field.value == "" %}
        {% else %}
        <p class="title is-size-4">{{ field.label|capfirst }}</p>
        <p class="subtitle is-size-5">{{ field.value|capfirst }}</p>
        {% endif %}
    </span>
    {% endfor %}
</div>
<table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-size-5">
    <thead class="is-selected">
        <tr class="is-selected">
            {% comment %} <th>#</th> {% endcomment %}
            <th style="text-align: center;">Type</th>
            <th style="text-align: center;">Total vente</th>
            <th style="text-align: center;">Montant total</th>
        </tr>
    </thead>
    <tbody>
        {% for report in reports.facturations.reports %}
        <tr>
            {% comment %} <td style="text-align: center;">{{ forloop.counter0 }}</td> {% endcomment %}
            <td style="text-align: center;">{{ report.type}}</td>
            <td style="text-align: center;">{{ report.total}}</td>
            <td style="text-align: center;">{{ report.total_price.normalize|intcomma}} XFA</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th style="text-align: center;" colspan="1">TOTAL</th>
            <th style="text-align: center;" colspan="1">{{ reports.facturations.total }}</th>
            <th style="text-align: center;" colspan="1">{{ reports.facturations.total_price.normalize|intcomma }} XFA
            </th>
        </tr>
    </tfoot>
</table>

<table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-size-5">
    <p class="title is-size-4">Rapport des flux d'argent</p>

    <thead class="is-selected">
        <tr class="is-selected">
            {% comment %} <th>#</th> {% endcomment %}
            <th style="text-align: center;">Catégories</th>
            <th style="text-align: center;">Total </th>
            <th style="text-align: center;">Solde total</th>
        </tr>
    </thead>
    <tbody>
        {% for cashflow_report in reports.cashflow.report %}
        <tr>
            {% comment %} <td style="text-align: center;">{{ forloop.counter0 }}</td> {% endcomment %}
            <td style="text-align: center;">{{ cashflow_report.name}}</td>
            <td style="text-align: center;">{{ cashflow_report.total}}</td>
            <td style="text-align: center;">{{ cashflow_report.total_amount.normalize|intcomma}} XFA</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th style="text-align: center;" colspan="1">Net en caisse</th>
            <th style="text-align: center;" colspan="1"></th>
            <th style="text-align: center;" colspan="1">{{ reports.cashflow.balance.normalize|intcomma }} XFA
            </th>
        </tr>
    </tfoot>
</table>



<p class="title is-size-3">Rapport des commerciaux</p>

<table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-size-5">
    <thead>
        <tr class="is-selected is-size-7">
            <th class="has-text-centered is-vcentered">Commercial</th>
            <th class="has-text-centered is-vcentered">Vente en espèces</th>
            <th class="has-text-centered is-vcentered">Vente à termes</th>
            <th class="has-text-centered is-vcentered">Vente de services</th>
            <th class="has-text-centered is-vcentered">Total ventes</th>
            <th class="has-text-centered is-vcentered">Montant total</th>
        </tr>
    </thead>
    <tbody>
        {% for commercial_report in reports.commercial_reports %}
        <tr>
            {% comment %} <td style="text-align: center;">{{ forloop.counter0 }}</td> {% endcomment %}
            <td class="has-text-weight-semibold is-size-7" style="text-align: center;">{{ commercial_report.commercial}}
            </td>
            <td style="text-align: center;">
                <article class="message is-dark has-text-centered p-0 m-0">
                    <div class="message-body p-1">
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Total:</span><span
                                class="has-text-weight-light">{{ commercial_report.facturation_data.total_facturations}}</span>
                        </p>
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Montant:</span><span
                                class="has-text-weight-light">{{ commercial_report.facturation_data.total_facturation_price.normalize|intcomma}}
                                XFA</span>
                        </p>
                    </div>
                </article>
            </td>
            <td style="text-align: center;">
                <article class="message is-dark has-text-centered p-0 m-0">
                    <div class="message-body p-1">
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Total:</span><span
                                class="has-text-weight-light">{{ commercial_report.voucher_facturation_data.total_facturations}}</span>
                        </p>
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Montant:</span><span
                                class="has-text-weight-light">{{ commercial_report.voucher_facturation_data.total_facturation_price.normalize|intcomma}}
                                XFA</span>
                        </p>
                    </div>
                </article>
            </td>
            <td style="text-align: center;">
                <article class="message is-dark has-text-centered p-0 m-0">
                    <div class="message-body p-1">
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Total:</span><span
                                class="has-text-weight-light">{{ commercial_report.service_facturation_data.total_facturations}}</span>
                        </p>
                        <p class="has-text-left is-size-7"><span class="has-text-weight-bold mr-1">Montant:</span><span
                                class="has-text-weight-light">{{ commercial_report.service_facturation_data.total_facturation_price.normalize|intcomma}}
                                XFA</span>
                        </p>
                    </div>
                </article>
            </td>
            <td class="has-text-weight-semibold is-size-7" style="text-align: center;">
                {{ commercial_report.total_facturations}}
            </td>
            <td class="has-text-weight-semibold is-size-7" style="text-align: center;">
                {{ commercial_report.total_facturation_price.normalize|intcomma}} XFA</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p class="title is-size-3">Inventaire temps réel des stocks de produits</p>
<table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-size-5">
    <thead class="is-selected">
        <tr class="is-selected">
            {% comment %} <th>#</th> {% endcomment %}
            <th style="text-align: center;">Produit</th>
            <th style="text-align: center;">Quantité</th>
            <th style="text-align: center;">Estimation d'achat</th>
            <th style="text-align: center;">Estimation de vente</th>
            <th style="text-align: center;">Estimation de profit</th>
        </tr>
    </thead>
    <tbody>
        {% for product in reports.product_reports %}
        <tr>
            {% comment %} <td style="text-align: center;">{{ forloop.counter0 }}</td> {% endcomment %}
            <td style="text-align: center;">{{ product.name}}</td>
            <td style="text-align: center;">{{ product.quantity|intcomma}}</td>
            <td style="text-align: center;">{{ product.total_purchase_price.normalize|intcomma}} XFA</td>
            <td style="text-align: center;">{{ product.total_facturation_price.normalize|intcomma}} XFA</td>
            <td class="has-text-weight-semibold" style="text-align: center;">
                {{ product.total_profit.normalize|intcomma}}
                XFA
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock content %}