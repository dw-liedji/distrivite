{% load static %}
{% load humanize %}
{% load qr_code %}
{% load core %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'core/css/quanta.min.css' %}" />

    {% comment %}
    <link rel="stylesheet" href="../../static/core/css/printer.css"> {% endcomment %}
    <style>
        @page {
            size: 70mm 200mm;
            margin: 0;
            padding: 0;
        }

        * {
            font-size: 12px;
            font-family: 'Times New Roman';
        }


        body {
            height: auto;
            /* Set the height to auto to adjust to the content 
            margin: 0;
            padding: 0;*/
        }

        .ticket {
            width: 215px;
            max-width: 215px;
        }

        @media print {

            .hidden-print,
            .hidden-print * {
                display: none !important;
            }

        }
    </style>
    <title>Receipt</title>
</head>


<body class="block m-0 p-0">
    <div class="box ticket m-0 p-0">

        <div class="is-flex is-justify-content-space-between is-align-items-center p-0 mx-0 my-0">

            <div class="p-0 mr-1 ml-0">
                {% if request.organization.logo %}
                <img class="img" style="width: 64px; height: 64px;" src="{{ request.organization.logo.url }}">
                {% else %}
                <img class="img" style="width: 64px; height: 64px;" src="{% static 'core/img/quanta_logo.jpg' %}">
                {% endif %}
            </div>
            <div class="is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end p-0 m-0">
                <p class="has-text-weight-bold has-text-right">{{ request.organization.name|upper }}</p>
                <p class="has-text-right"> {{ request.organization.street_address }} </p>
            </div>
            {% comment %} <br>{{ request.organization.contact_email }} {% endcomment %}
            {% comment %} <br> Tel:{{ request.organization.contact_number }}</p> {% endcomment %}
        </div>

        <div class="is-flex is-justify-content-space-between is-align-items-center p-0 mx-0 my-1">
            <div class="m-0 p-1">
                <p> <span style="padding-left: 0px;"><b>Réçu No:</b></span>
                    {{ coverage_facturation.bill_number|default_if_none:"N/A" }}
                    </span></p>

            </div>
            <!-- <img class="is-student-profile-code" src="../../static/accounts/img/profile.jpg" alt=""> -->
            <img class="image p-0 m-0 is-64x64"
                src="{% qr_url_from_text coverage_facturation.pk size=8 version=4 image_format='png' %}" alt="liedjify">
        </div>

        <p class="has-text-centered has-text-weight-bold" style="font-size: 10px;">
            {{ coverage_facturation.medical_visit.patient.username|upper }}</p>

        <table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth my-0 py-0 is-size-7">
            <thead>
                <tr>
                    <th class="mx-0 px-0 is-selected" style="text-align: center;">Product</th>
                    <th class="mx-0 px-0 is-selected" style="text-align: center;">Qty</th>
                    <th class="mx-0 px-0 is-selected" style="text-align: center;">Total</th>
                </tr>
            </thead>
            <tbody>

                {% for coverage_facturation_stock in coverage_facturation.coverage_facturation_stocks.all %}
                <tr>
                    <td class="mx-0 px-0" style="text-align: center;">{{ coverage_facturation_stock.batch.item.name }}
                    </td>
                    <td class="mx-0 px-0" style="text-align: center;">{{ coverage_facturation_stock.quantity }}</td>
                    <td class="mx-0 px-0" style="text-align: center;">
                        {{ coverage_facturation_stock.total_price.normalize }}
                    </td>
                </tr>
                {% endfor %}


                <tr>
                    <td class="mx-0 px-0 is-dark" style="text-align: center;">TOTAL Price</td>
                    {% comment %} <td class="mx-0 px-0 is-dark" style="text-align: center;">
                        {{ coverage_facturation.quantity|intcomma }}
                    </td> {% endcomment %}
                    <td colspan="3" class="mx-0 px-0 is-dark" style="text-align: center;">
                        {{ coverage_facturation.total_price.normalize|intcomma }}
                        F</td>
                </tr>
                <tr>
                    <td colspan="3" style="font-size: 10px; text-align: center;">
                        {{ coverage_facturation.total_price.normalize|to_words|capfirst }} FCFA
                    </td>
                </tr>
            </tbody>
        </table>

        <div>
            <p class="has-text-centered">
                {{ request.organization.city }}, {{ coverage_facturation.created|default_if_none:"N/A" }}
            </p>
            {% comment %} <p class="has-text-centered my-0 py-0">Merci pour votre confiance!</p> {% endcomment %}
            <p class="has-text-centered is-size-6 has-text-weight-semibold my-0 py-0">www.datavite.com</p>
        </div>


        <div class="is-flex is-flex-direction-column is-justify-content-center my-2">
            <button id="btnPrint" class="button is-primary bulma-success-button hidden-print my-2">Imprimer
                Maintenant</button>
            {% comment %} <a id="btnDownload" class="button is-link bulma-button hidden-print my-2"
                href="{% url 'organization_features:pos:coverage_facturation_bill' request.organization.slug coverage_facturation.pk %}">Télécharger
                PDF</a> {% endcomment %}
        </div>
        {% comment %} <script src="../../static/core/js/printer.js"></script> {% endcomment %}
        <script src="{% static 'core/js/printer.js' %}"></script>
    </div>

</body>

</html>