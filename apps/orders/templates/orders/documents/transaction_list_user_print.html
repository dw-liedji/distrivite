{% extends "core/pdf_base.html" %}
{% load crispy_forms_tags %}
{% load humanize %}
{% load qr_code %}
{% load static %}
{% load mathfilters %}
{% load l10n %}
{% load core %}
{% load partials %}

{% block title %}
Organizations facturation report pdf
{% endblock title %}

{% block content %}

<div class="has-text-left">
    <div class="is-flex is-justify-content-center is-align-items-center">
        <figure class="image box p-0 my-0 ml-0 mr-3">
            {% if request.organization.logo %}
            <img width= "150px" height= "110px" class="image" src="{{ request.organization.logo.url }}"  style="width: 150px; height: 110px;">
            {% else %}
            <img class="image" src="{% static 'core/img/quanta_logo.jpg' %}"  style="width: 150px; height: 110px;">
            {% endif %}
        </figure>
        <div class="box has-text-centered p-0 m-0">
            <p class="title is-size-1 mb-3 pb-0">{{ request.organization.name|upper }}</p>
            <p class="title is-size-3 mb-5 pb-0">{{ request.organization.sub_name|upper }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">{{ request.organization.street_address }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">BP 8735-YANSOKI-DOUALA,
                tel:{{ request.organization.contact_number }}</p>
            <p class="subtitle is-size-6 has-text-centered m-0 p-0">Email:{{ request.organization.contact_email }}</p>
        </div>
    </div>
</div>
<hr class="mb-1" />

<p class="title is-size-4 has-text-weight-bold">Rapport détaillé des transactions par personnels</p>

<p class="subtitle is-size-6 has-text-centered">Imprimé le {% now "SHORT_DATETIME_FORMAT" %}</p>
    <table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-size-7">
        <thead>
            <tr class="is-selected">
                {% for field in filter_form_data_list %}<th style="text-align: center;">{{ field.label }}</th>{% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                {% for field in filter_form_data_list %}
                    <td style="text-align: center;">
                        {% if field.value == "None" %}
                        {% else %}
                            {{ field.value }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        </tbody>
</table>

{% load humanize %}

<p class="title is-size-4 has-text-weight-bold">Global Transactions Summary</p>
<table class="table is-bordered is-striped is-fullwidth is-size-7">
    <thead>
        <tr class="has-background-primary-light">
            <th>Total Deposit</th>
            <th>Total Withdrawal</th>
            <th>Net Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="has-text-success">{{ global_deposit.normalize|intcomma }} F</td>
            <td class="has-text-danger">{{ global_withdrawal.normalize|intcomma }} F</td>
            <td>{{ global_net.normalize|intcomma }} F</td>
        </tr>
    </tbody>
</table>

{% for user in report %}
<section style="page-break-inside: avoid;">
    <p class="title is-size-5 has-text-weight-bold">{{ user.user_name }}</p>

    <table class="table is-bordered is-striped is-fullwidth is-size-7">
        <thead class="has-background-info-light">
            <tr>
                <th>Total Deposit</th>
                <th>Total Withdrawal</th>
                <th>Net Amount</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="has-text-success">{{ user.summary.total_deposit.normalize|intcomma }} F</td>
                <td class="has-text-danger">{{ user.summary.total_withdrawal.normalize|intcomma }} F</td>
                <td>{{ user.summary.net_amount.normalize|intcomma }} F</td>
            </tr>
        </tbody>
    </table>

    <table class="table is-bordered is-striped is-hoverable is-fullwidth is-size-7">
        <thead class="has-background-primary-light">
            <tr>
                <th>Broker</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Participant</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            {% for tx in user.transactions %}
            <tr>
                <td>{{ tx.transaction_broker }}</td>
                <td>{{ tx.transaction_type }}</td>
                <td class="has-text-centered">{{ tx.amount.normalize|intcomma }} F</td>
                <td>{{ tx.participant }}</td>
                <td>{{ tx.reason }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if not forloop.last %}
    <div style="page-break-after: always;"></div>
    {% endif %}
</section>
{% endfor %}

{% endblock content %}